#!/usr/bin/expect -f
# Test: Open a file in bash, verify content renders, quit
set timeout 10

# Create test file
set fd [open "/tmp/em_test_input.txt" w]
puts $fd "Hello World"
puts $fd "Second Line"
puts $fd "Third Line"
close $fd

spawn bash --norc --noprofile -c "source ./em.sh && em /tmp/em_test_input.txt"

expect {
    "Hello World" { puts "\nPASS: file content rendered" }
    timeout { puts "\nFAIL: file content not shown"; exit 1 }
}

expect {
    "em_test_input.txt" { puts "PASS: filename in status line" }
    timeout { puts "FAIL: filename not in status line"; exit 1 }
}

# C-x C-c to quit
send "\x18\x03"

expect {
    eof { puts "PASS: editor exited cleanly" }
    timeout { puts "FAIL: editor did not exit"; exit 1 }
}

puts "TEST PASSED: bash open file"
